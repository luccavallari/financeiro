!function($){"use strict";var isIphone=void 0!==window.orientation,isAndroid=navigator.userAgent.toLowerCase().indexOf("android")>-1,Inputmask=function(element,options){isAndroid||(this.$element=$(element),this.options=$.extend({},$.fn.inputmask.defaults,options),this.mask=String(options.mask),this.init(),this.listen(),this.checkVal())};Inputmask.prototype={init:function(){var defs=this.options.definitions,len=this.mask.length;this.tests=[],this.partialPosition=this.mask.length,this.firstNonMaskPos=null,$.each(this.mask.split(""),$.proxy(function(i,c){"?"==c?(len--,this.partialPosition=i):defs[c]?(this.tests.push(new RegExp(defs[c])),null===this.firstNonMaskPos&&(this.firstNonMaskPos=this.tests.length-1)):this.tests.push(null)},this)),this.buffer=$.map(this.mask.split(""),$.proxy(function(c){return"?"!=c?defs[c]?this.options.placeholder:c:void 0},this)),this.focusText=this.$element.val(),this.$element.data("rawMaskFn",$.proxy(function(){return $.map(this.buffer,function(c,i){return this.tests[i]&&c!=this.options.placeholder?c:null}).join("")},this))},listen:function(){if(!this.$element.attr("readonly")){var pasteEventName=(navigator.userAgent.match(/msie/i)?"paste":"input")+".mask";this.$element.on("unmask",$.proxy(this.unmask,this)).on("focus.mask",$.proxy(this.focusEvent,this)).on("blur.mask",$.proxy(this.blurEvent,this)).on("keydown.mask",$.proxy(this.keydownEvent,this)).on("keypress.mask",$.proxy(this.keypressEvent,this)).on(pasteEventName,$.proxy(this.pasteEvent,this))}},caret:function(begin,end){if(0!==this.$element.length){if("number"==typeof begin)return end="number"==typeof end?end:begin,this.$element.each(function(){if(this.setSelectionRange)this.setSelectionRange(begin,end);else if(this.createTextRange){var range=this.createTextRange();range.collapse(!0),range.moveEnd("character",end),range.moveStart("character",begin),range.select()}});if(this.$element[0].setSelectionRange)begin=this.$element[0].selectionStart,end=this.$element[0].selectionEnd;else if(document.selection&&document.selection.createRange){var range=document.selection.createRange();begin=0-range.duplicate().moveStart("character",-1e5),end=begin+range.text.length}return{begin:begin,end:end}}},seekNext:function(pos){for(var len=this.mask.length;++pos<=len&&!this.tests[pos];);return pos},seekPrev:function(pos){for(;--pos>=0&&!this.tests[pos];);return pos},shiftL:function(begin,end){var len=this.mask.length;if(!(0>begin)){for(var i=begin,j=this.seekNext(end);len>i;i++)if(this.tests[i]){if(!(len>j&&this.tests[i].test(this.buffer[j])))break;this.buffer[i]=this.buffer[j],this.buffer[j]=this.options.placeholder,j=this.seekNext(j)}this.writeBuffer(),this.caret(Math.max(this.firstNonMaskPos,begin))}},shiftR:function(pos){for(var len=this.mask.length,i=pos,c=this.options.placeholder;len>i;i++)if(this.tests[i]){var j=this.seekNext(i),t=this.buffer[i];if(this.buffer[i]=c,!(len>j&&this.tests[j].test(t)))break;c=t}},unmask:function(){this.$element.unbind(".mask").removeData("inputmask")},focusEvent:function(){this.focusText=this.$element.val();var len=this.mask.length,pos=this.checkVal();this.writeBuffer();var that=this,moveCaret=function(){pos==len?that.caret(0,pos):that.caret(pos)};navigator.userAgent.match(/msie/i)?moveCaret():setTimeout(moveCaret,0)},blurEvent:function(){this.checkVal(),this.$element.val()!=this.focusText&&this.$element.trigger("change")},keydownEvent:function(e){var k=e.which;if(8==k||46==k||isIphone&&127==k){var pos=this.caret(),begin=pos.begin,end=pos.end;return end-begin===0&&(begin=46!=k?this.seekPrev(begin):end=this.seekNext(begin-1),end=46==k?this.seekNext(end):end),this.clearBuffer(begin,end),this.shiftL(begin,end-1),!1}return 27==k?(this.$element.val(this.focusText),this.caret(0,this.checkVal()),!1):void 0},keypressEvent:function(e){var len=this.mask.length,k=e.which,pos=this.caret();if(e.ctrlKey||e.altKey||e.metaKey||32>k)return!0;if(k){pos.end-pos.begin!==0&&(this.clearBuffer(pos.begin,pos.end),this.shiftL(pos.begin,pos.end-1));var p=this.seekNext(pos.begin-1);if(len>p){var c=String.fromCharCode(k);if(this.tests[p].test(c)){this.shiftR(p),this.buffer[p]=c,this.writeBuffer();var next=this.seekNext(p);this.caret(next)}}return!1}},pasteEvent:function(){var that=this;setTimeout(function(){that.caret(that.checkVal(!0))},0)},clearBuffer:function(start,end){for(var len=this.mask.length,i=start;end>i&&len>i;i++)this.tests[i]&&(this.buffer[i]=this.options.placeholder)},writeBuffer:function(){return this.$element.val(this.buffer.join("")).val()},checkVal:function(allow){for(var len=this.mask.length,test=this.$element.val(),lastMatch=-1,i=0,pos=0;len>i;i++)if(this.tests[i]){for(this.buffer[i]=this.options.placeholder;pos++<test.length;){var c=test.charAt(pos-1);if(this.tests[i].test(c)){this.buffer[i]=c,lastMatch=i;break}}if(pos>test.length)break}else this.buffer[i]==test.charAt(pos)&&i!=this.partialPosition&&(pos++,lastMatch=i);return!allow&&lastMatch+1<this.partialPosition?(this.$element.val(""),this.clearBuffer(0,len)):(allow||lastMatch+1>=this.partialPosition)&&(this.writeBuffer(),allow||this.$element.val(this.$element.val().substring(0,lastMatch+1))),this.partialPosition?i:this.firstNonMaskPos}},$.fn.inputmask=function(options){return this.each(function(){var $this=$(this),data=$this.data("inputmask");data||$this.data("inputmask",data=new Inputmask(this,options))})},$.fn.inputmask.defaults={mask:"",placeholder:"_",definitions:{9:"[0-9]",a:"[A-Za-z]","?":"[A-Za-z0-9]","*":"."}},$.fn.inputmask.Constructor=Inputmask,$(document).on("focus.inputmask.data-api","[data-mask]",function(e){var $this=$(this);$this.data("inputmask")||(e.preventDefault(),$this.inputmask($this.data()))})}(window.jQuery);